<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>lbd-phone-input · Playground</title>
    <link rel="stylesheet" href="../dist/styles.css" />
    <style>
      :root {
        color-scheme: light dark;
      }

      body {
        font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
        min-height: 100vh;
        margin: 0;
        background: radial-gradient(circle at top, #f4f7fb, #dbeafe);
        padding: 5vw;
        display: flex;
        justify-content: center;
      }

      .playground {
        width: min(960px, 100%);
        background: rgba(255, 255, 255, 0.9);
        border-radius: 30px;
        padding: 48px;
        box-shadow: 0 40px 120px -48px rgba(15, 23, 42, 0.4);
        display: grid;
        gap: 36px;
      }

      .playground[data-theme="dark"] {
        background: rgba(15, 23, 42, 0.92);
        color: #f8fafc;
      }

      h1 {
        margin: 0;
        font-size: clamp(2rem, 3vw + 1rem, 3rem);
      }

      .grid {
        display: grid;
        gap: 18px;
      }

      .grid-advanced {
        display: grid;
        gap: 12px;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      }

      label span {
        display: block;
        font-weight: 600;
        margin-bottom: 6px;
      }

      select,
      input[type="text"],
      button {
        width: 100%;
        padding: 10px 14px;
        border-radius: 12px;
        border: 1px solid rgba(15, 23, 42, 0.12);
        background: rgba(255, 255, 255, 0.9);
        font: inherit;
      }

      .playground[data-theme="dark"] select,
      .playground[data-theme="dark"] input[type="text"],
      .playground[data-theme="dark"] button {
        background: rgba(15, 23, 42, 0.6);
        border-color: rgba(148, 163, 184, 0.35);
        color: inherit;
      }

      .switches {
        display: grid;
        gap: 10px;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      }

      .switch {
        display: flex;
        gap: 10px;
        align-items: center;
        background: rgba(148, 163, 184, 0.12);
        padding: 10px 12px;
        border-radius: 12px;
        font-size: 0.92rem;
      }

      .playground[data-theme="dark"] .switch {
        background: rgba(30, 41, 59, 0.6);
      }

      .split {
        display: grid;
        gap: 12px;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      }

      pre {
        background: #0f172a;
        color: #cbd5f5;
        border-radius: 16px;
        padding: 16px;
        overflow-x: auto;
        font-size: 0.85rem;
        margin: 0;
      }

      .actions {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
      }

      button.primary {
        background: #4f46e5;
        color: white;
        border: none;
      }

      button.secondary {
        background: rgba(148, 163, 184, 0.18);
      }
    </style>
  </head>
  <body>
    <main class="playground" data-theme="auto">
      <section class="grid" aria-labelledby="intro">
        <h1 id="intro">lbd-phone-input playground</h1>
        <p>
          Experiment with every option exposed by <code>createPhoneInput</code>. Toggle settings below and
          watch the component, bindings, and event payload update in real-time.
        </p>
      </section>

      <section class="grid" aria-labelledby="controls">
        <h2 id="controls">Configuration</h2>
        <div class="grid-advanced">
          <label>
            <span>Flag display</span>
            <select id="flag-mode">
              <option value="sprite">Sprite (PNG)</option>
              <option value="emoji">Emoji</option>
              <option value="none">Hide flag</option>
            </select>
          </label>
          <label>
            <span>Theme</span>
            <select id="theme-mode">
              <option value="auto">Auto (system)</option>
              <option value="light">Light</option>
              <option value="dark">Dark</option>
            </select>
          </label>
          <label>
            <span>Language</span>
            <select id="language-mode">
              <option value="auto">Auto detect</option>
              <option value="en">English</option>
              <option value="it">Italiano</option>
              <option value="es">Español</option>
              <option value="fr">Français</option>
              <option value="de">Deutsch</option>
              <option value="pt">Português</option>
              <option value="ru">Русский</option>
              <option value="zh">中文</option>
              <option value="ja">日本語</option>
              <option value="ar">العربية</option>
            </select>
          </label>
          <label>
            <span>Preferred countries (comma separated ISO2)</span>
            <input id="preferred-list" type="text" value="it,us,gb" />
          </label>
        </div>
        <div class="switches">
          <label class="switch">
            <input type="checkbox" id="national-mode" />
            <span>National mode</span>
          </label>
          <label class="switch">
            <input type="checkbox" id="auto-format" checked />
            <span>Auto format</span>
          </label>
          <label class="switch">
            <input type="checkbox" id="smart-placeholder" checked />
            <span>Smart placeholder</span>
          </label>
          <label class="switch">
            <input type="checkbox" id="close-on-select" checked />
            <span>Close dropdown on selection</span>
          </label>
        </div>
        <div class="actions">
          <button id="reset-options" type="button" class="secondary">Reset configuration</button>
          <button id="prefill-gb" type="button" class="primary">Prefill +44 20 7946 0958</button>
          <button id="clear-input" type="button" class="secondary">Clear</button>
        </div>
      </section>

      <section class="grid" aria-labelledby="demo">
        <h2 id="demo">Live widget</h2>
        <label class="grid">
          <span>Phone number</span>
          <input id="demo-phone" type="tel" autocomplete="tel" />
        </label>
        <div class="split">
          <label>
            <span>Dial code (binding)</span>
            <input id="binding-dial" readonly />
          </label>
          <label>
            <span>National number (binding)</span>
            <input id="binding-number" readonly />
          </label>
          <label>
            <span>E.164 / combined (binding)</span>
            <input id="binding-combined" readonly />
          </label>
        </div>
      </section>

      <section class="grid" aria-labelledby="payload">
        <h2 id="payload">Event payload</h2>
        <pre id="log">{}</pre>
      </section>
    </main>

    <script type="module">
      import { createPhoneInput, detectBrowserCountry } from "../dist/index.js";

      const phoneInput = document.querySelector("#demo-phone");
      const flagModeSelect = document.querySelector("#flag-mode");
      const themeModeSelect = document.querySelector("#theme-mode");
      const languageModeSelect = document.querySelector("#language-mode");
      const preferredListInput = document.querySelector("#preferred-list");
      const nationalModeToggle = document.querySelector("#national-mode");
      const autoFormatToggle = document.querySelector("#auto-format");
      const smartPlaceholderToggle = document.querySelector("#smart-placeholder");
      const closeOnSelectToggle = document.querySelector("#close-on-select");
      const resetButton = document.querySelector("#reset-options");
      const prefillGbButton = document.querySelector("#prefill-gb");
      const clearButton = document.querySelector("#clear-input");
      const bindingDial = document.querySelector("#binding-dial");
      const bindingNumber = document.querySelector("#binding-number");
      const bindingCombined = document.querySelector("#binding-combined");
      const log = document.querySelector("#log");
      const playground = document.querySelector(".playground");

      const defaultState = {
        flagDisplay: "sprite",
        theme: "auto",
        language: undefined,
        preferredCountries: ["it", "us", "gb"],
        nationalMode: false,
        autoFormat: true,
        smartPlaceholder: true,
        closeDropdownOnSelection: true
      };

      const state = { ...defaultState };

      const sharedOptions = {
        bindings: {
          dialCode: bindingDial,
          nationalNumber: bindingNumber,
          combined: bindingCombined
        },
        preventInvalidDialCode: true
      };

      function parsePreferred(text) {
        return text
          .split(/[,\s]+/)
          .map((item) => item.trim().toLowerCase())
          .filter(Boolean);
      }

      function applyTheme(theme) {
        playground.dataset.theme = theme;
        document.body.dataset.theme = theme;
      }

      function updateLog(state) {
        log.textContent = JSON.stringify(
          {
            country: state.country.name,
            iso2: state.country.iso2,
            dialCode: state.dialCode,
            nationalNumber: state.nationalNumber,
            formattedValue: state.formattedValue,
            rawValue: state.rawValue,
            e164: state.e164,
            theme: state.theme,
            isValid: state.isValid
          },
          null,
          2
        );
      }

      let controller;

      function mount(value) {
        controller = createPhoneInput(phoneInput, {
          ...sharedOptions,
          flagDisplay: state.flagDisplay,
          preferredCountries: state.preferredCountries,
          nationalMode: state.nationalMode,
          autoFormat: state.autoFormat,
          smartPlaceholder: state.smartPlaceholder,
          closeDropdownOnSelection: state.closeDropdownOnSelection,
          language: state.language,
          theme: state.theme,
          value,
          onChange: updateLog
        });
        controller.setTheme(state.theme);
        applyTheme(state.theme);
        updateLog(controller.getState());
      }

      function remount(preserveValue = true) {
        const snapshot = preserveValue
          ? {
              dialCode: controller.getDialCode(),
              nationalNumber: controller.getState().nationalNumber,
              combined: controller.getState().e164 || controller.getState().formattedValue
            }
          : undefined;
        controller.destroy();
        mount(snapshot);
      }

      mount({ dialCode: "+39", nationalNumber: "3471234567" });

      detectBrowserCountry().then((iso2) => {
        if (iso2) {
          controller.setCountry(iso2);
          updateLog(controller.getState());
        }
      });

      flagModeSelect.addEventListener("change", (event) => {
        state.flagDisplay = event.target.value;
        remount();
      });

      themeModeSelect.addEventListener("change", (event) => {
        state.theme = event.target.value;
        controller.setTheme(state.theme);
        applyTheme(state.theme);
        updateLog(controller.getState());
      });

      languageModeSelect.addEventListener("change", (event) => {
        state.language = event.target.value === "auto" ? undefined : event.target.value;
        remount();
      });

      preferredListInput.addEventListener("blur", (event) => {
        const parsed = parsePreferred(event.target.value);
        if (!parsed.length) {
          event.target.value = defaultState.preferredCountries.join(", ");
          state.preferredCountries = [...defaultState.preferredCountries];
        } else {
          state.preferredCountries = parsed;
        }
        remount();
      });

      [
        [nationalModeToggle, "nationalMode"],
        [autoFormatToggle, "autoFormat"],
        [smartPlaceholderToggle, "smartPlaceholder"],
        [closeOnSelectToggle, "closeDropdownOnSelection"]
      ].forEach(([toggle, key]) => {
        toggle.addEventListener("change", () => {
          state[key] = toggle.checked;
          remount();
        });
      });

      resetButton.addEventListener("click", () => {
        Object.assign(state, defaultState);
        flagModeSelect.value = state.flagDisplay;
        themeModeSelect.value = state.theme;
        languageModeSelect.value = "auto";
        preferredListInput.value = state.preferredCountries.join(", ");
        nationalModeToggle.checked = state.nationalMode;
        autoFormatToggle.checked = state.autoFormat;
        smartPlaceholderToggle.checked = state.smartPlaceholder;
        closeOnSelectToggle.checked = state.closeDropdownOnSelection;
        remount(false);
      });

      prefillGbButton.addEventListener("click", () => {
        controller.setCountry("gb");
        controller.setValue({ combined: "+442079460958" });
        updateLog(controller.getState());
      });

      clearButton.addEventListener("click", () => {
        controller.setValue({ dialCode: controller.getDialCode(), nationalNumber: "" });
        bindingCombined.value = "";
        updateLog(controller.getState());
      });
    </script>
  </body>
</html>
